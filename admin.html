<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - MedShop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); }
        .preview-image { max-width: 200px; max-height: 200px; object-fit: cover; border-radius: 12px; }
        .product-card { position: relative; overflow: hidden; }
        .product-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    </style>
</head>
<body class="bg-gray-50">
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-shield-alt text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Admin Panel</h1>
                        <p class="text-sm opacity-90">MedShop - Gestion des produits</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="window.location.href='index.html'" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition">
                        <i class="fas fa-home mr-2"></i>Voir le site
                    </button>
                    <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition">
                        <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="stat-card rounded-2xl p-6 card-hover shadow-lg">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-white/80 text-sm font-medium">Total Produits</p>
                        <p class="text-4xl font-bold mt-2" id="totalProducts">0</p>
                    </div>
                    <div class="bg-white/20 p-4 rounded-xl">
                        <i class="fas fa-box text-3xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl p-6 card-hover shadow-lg border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Prix Moyen</p>
                        <p class="text-4xl font-bold text-gray-800 mt-2" id="avgPrice">0</p>
                        <span class="text-green-600 text-sm font-semibold">FCFA</span>
                    </div>
                    <div class="bg-green-100 p-4 rounded-xl">
                        <i class="fas fa-chart-line text-3xl text-green-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl p-6 card-hover shadow-lg border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Dernière MAJ</p>
                        <p class="text-lg font-bold text-gray-800 mt-2" id="lastUpdate">Jamais</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-xl">
                        <i class="fas fa-clock text-3xl text-blue-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <div class="flex items-center gap-3 mb-6">
                <i class="fas fa-plus-circle text-3xl text-purple-600"></i>
                <h2 class="text-2xl font-bold text-gray-800">Ajouter un nouveau produit</h2>
            </div>
            
            <form id="productForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-tag mr-2 text-purple-600"></i>Nom du produit
                        </label>
                        <input type="text" id="productName" required
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                            placeholder="Ex: Savon médical">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-dollar-sign mr-2 text-purple-600"></i>Prix (FCFA)
                        </label>
                        <input type="number" id="productPrice" required min="0"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                            placeholder="1000">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-layer-group mr-2 text-purple-600"></i>Catégorie
                        </label>
                        <select id="productCategory" required
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition">
                            <option value="">Sélectionnez une catégorie</option>
                            <option value="savon">Savon</option>
                            <option value="poudre">Poudre médicale</option>
                            <option value="pomade">Pomade</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-boxes mr-2 text-purple-600"></i>Stock disponible
                        </label>
                        <input type="number" id="productStock" required min="0"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                            placeholder="50">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left mr-2 text-purple-600"></i>Description
                    </label>
                    <textarea id="productDescription" rows="4" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                        placeholder="Décrivez les bienfaits et utilisations du produit..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-image mr-2 text-purple-600"></i>Image du produit
                    </label>
                    <div class="flex items-center gap-4">
                        <label class="flex-1 cursor-pointer">
                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-purple-500 transition">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-600">Cliquez pour choisir une image</p>
                                <p class="text-xs text-gray-400 mt-1">ou entrez une URL ci-dessous</p>
                            </div>
                            <input type="file" id="productImageFile" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                        </label>
                    </div>
                    <input type="url" id="productImageUrl"
                        class="w-full mt-3 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                        placeholder="Ou collez l'URL de l'image ici">
                    <div id="imagePreview" class="mt-4 hidden">
                        <p class="text-sm font-semibold text-gray-700 mb-2">Aperçu :</p>
                        <img id="previewImg" class="preview-image shadow-lg" src="" alt="Aperçu">
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 gradient-bg text-white px-6 py-4 rounded-xl font-bold text-lg hover:shadow-lg transition transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>Ajouter le produit
                    </button>
                    <button type="button" onclick="resetForm()" class="px-6 py-4 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300 transition">
                        <i class="fas fa-redo mr-2"></i>Réinitialiser
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <i class="fas fa-list text-3xl text-purple-600"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Liste des produits</h2>
                </div>
                <div class="flex gap-3">
                    <input type="text" id="searchProduct" placeholder="Rechercher un produit..."
                        class="px-4 py-2 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition"
                        onkeyup="filterProducts()">
                    <select id="filterCategory" onchange="filterProducts()"
                        class="px-4 py-2 border-2 border-gray-200 rounded-xl focus:border-purple-500 transition">
                        <option value="">Toutes catégories</option>
                        <option value="savon">Savon</option>
                        <option value="poudre">Poudre médicale</option>
                        <option value="pomade">Pomade</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
            </div>

            <div id="productsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            
            <div id="noProducts" class="text-center py-12 hidden">
                <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                <p class="text-gray-500 text-lg">Aucun produit trouvé</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js';

        // ⚠️ REMPLACEZ PAR VOS PROPRES CLÉS FIREBASE
        const firebaseConfig = {
            aapiKey: "AIzaSyD0b69uQMJzpJagMgKrBqif26kv3wtXZwc",
  authDomain: "medshop-d78e1.firebaseapp.com",
  projectId: "medshop-d78e1",
  storageBucket: "medshop-d78e1.firebasestorage.app",
  messagingSenderId: "972474612085",
  appId: "1:972474612085:web:c2314bdc99eb652084fb3c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let allProducts = [];
        let currentImageFile = null;

        const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            allProducts = [];
            snapshot.forEach((doc) => {
                allProducts.push({ id: doc.id, ...doc.data() });
            });
            displayProducts(allProducts);
            updateStats();
        });

        window.handleImageUpload = function(event) {
            const file = event.target.files[0];
            if (file) {
                currentImageFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        document.getElementById('productImageUrl').addEventListener('input', function(e) {
            const url = e.target.value;
            if (url) {
                document.getElementById('previewImg').src = url;
                document.getElementById('imagePreview').classList.remove('hidden');
            }
        });

        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Ajout en cours...';
            submitBtn.disabled = true;

            try {
                let imageUrl = document.getElementById('productImageUrl').value;

                if (currentImageFile) {
                    const storageRef = ref(storage, `products/${Date.now()}_${currentImageFile.name}`);
                    await uploadBytes(storageRef, currentImageFile);
                    imageUrl = await getDownloadURL(storageRef);
                }

                const productData = {
                    name: document.getElementById('productName').value,
                    price: parseInt(document.getElementById('productPrice').value),
                    category: document.getElementById('productCategory').value,
                    stock: parseInt(document.getElementById('productStock').value),
                    description: document.getElementById('productDescription').value,
                    imageUrl: imageUrl || 'https://via.placeholder.com/300',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                await addDoc(collection(db, "products"), productData);
                showNotification('Produit ajouté avec succès !', 'success');
                resetForm();
            } catch (error) {
                console.error("Erreur:", error);
                showNotification('Erreur lors de l\'ajout du produit', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        function displayProducts(products) {
            const productsList = document.getElementById('productsList');
            const noProducts = document.getElementById('noProducts');

            if (products.length === 0) {
                productsList.innerHTML = '';
                noProducts.classList.remove('hidden');
                return;
            }

            noProducts.classList.add('hidden');
            productsList.innerHTML = products.map(product => `
                <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden card-hover">
                    <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-bold text-gray-800">${product.name}</h3>
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">
                                ${product.category}
                            </span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                        <div class="flex justify-between items-center mb-4">
                            <div class="text-2xl font-bold text-purple-600">${product.price} FCFA</div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-boxes text-gray-400"></i>
                                <span class="text-gray-600 font-semibold">${product.stock}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="deleteProduct('${product.id}')" class="flex-1 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition font-semibold">
                                <i class="fas fa-trash mr-2"></i>Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.deleteProduct = async function(productId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                try {
                    await deleteDoc(doc(db, "products", productId));
                    showNotification('Produit supprimé avec succès !', 'success');
                } catch (error) {
                    console.error("Erreur:", error);
                    showNotification('Erreur lors de la suppression', 'error');
                }
            }
        };

        window.filterProducts = function() {
            const searchTerm = document.getElementById('searchProduct').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;

            const filtered = allProducts.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                                    product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });

            displayProducts(filtered);
        };

        function updateStats() {
            document.getElementById('totalProducts').textContent = allProducts.length;
            
            const avgPrice = allProducts.length > 0 
                ? Math.round(allProducts.reduce((sum, p) => sum + p.price, 0) / allProducts.length)
                : 0;
            document.getElementById('avgPrice').textContent = avgPrice.toLocaleString();

            const lastUpdate = allProducts.length > 0
                ? new Date(allProducts[0].updatedAt).toLocaleDateString('fr-FR')
                : 'Jamais';
            document.getElementById('lastUpdate').textContent = lastUpdate;
        }

        window.resetForm = function() {
            document.getElementById('productForm').reset();
            document.getElementById('imagePreview').classList.add('hidden');
            currentImageFile = null;
        };

        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl z-50`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} text-2xl"></i>
                    <span class="font-semibold">${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        window.logout = function() {
            if (confirm('Voulez-vous vraiment vous déconnecter ?')) {
                window.location.href = 'index.html';
            }
        };
    </script>
</body>
</html>