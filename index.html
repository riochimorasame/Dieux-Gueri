<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vente de Produits M√©dicaux - MedShop</title>
    <meta name="description" content="D√©couvrez notre gamme de produits de sant√© et de bien-√™tre de qualit√©. Votre bien-√™tre est notre priorit√©.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style.css" />
    <style>
        .loading-products {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            flex-direction: column;
            gap: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .category-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .badge-savon { background: #dbeafe; color: #1e40af; }
        .badge-poudre { background: #fef3c7; color: #92400e; }
        .badge-pomade { background: #dcfce7; color: #166534; }
        .badge-autre { background: #f3e8ff; color: #6b21a8; }

        .new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            z-index: 10;
        }

        .product {
            position: relative;
        }

        .stock-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .stock-high {
            background: #d1fae5;
            color: #065f46;
        }

        .stock-low {
            background: #fef3c7;
            color: #92400e;
        }

        .stock-out {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">Votre bien-√™tre</div>
    <nav>
        <ul>
            <li><a href="index.html" class="active"><i class="fa-solid fa-house"></i> Accueil</a></li>
            <li><a href="articles.html"><i class="fa-solid fa-bag-shopping"></i> Nos Articles</a></li>
            <li><a href="chatbot.html"><i class="fa-solid fa-robot"></i> Assistant Virtuel</a></li>
            <li><a href="contact.html"><i class="fa-solid fa-envelope"></i> Contact</a></li>
            <li><a href="admin.html"><i class="fa-solid fa-user-shield"></i> Admin</a></li>
        </ul>
    </nav>
</header>

<section class="hero scroll-animate" id="hero">
    <h1><i class="fa-solid fa-heart-pulse"></i> Votre bien-√™tre, notre priorit√©</h1>
    <p>Nous vous offrons des produits de sant√© de qualit√© pour votre bien-√™tre au quotidien.</p>
    <a href="articles.html"><button>Acheter maintenant</button></a>
</section>

<section class="categories scroll-animate">
    <h2><i class="fa-solid fa-layer-group"></i> Cat√©gories</h2>
    <div class="category-list" id="categoryList">
        <div class="loading-products">
            <div class="loading-spinner"></div>
            <p style="color: #666; font-weight: 600;">Chargement des cat√©gories...</p>
        </div>
    </div>
</section>

<section class="products scroll-animate">
    <h2><i class="fa-solid fa-shopping-basket"></i> Produits Vedettes</h2>
    <div class="product-list" id="featuredProducts">
        <div class="loading-products">
            <div class="loading-spinner"></div>
            <p style="color: #666; font-weight: 600;">Chargement des produits...</p>
        </div>
    </div>
</section>

<div class="offer scroll-animate">
    <i class="fa-solid fa-gift"></i> <a href="articles.html">Profitez de nos offres sp√©ciales !</a> 
</div>

<section class="testimonial scroll-animate">
    <p><i class="fa-solid fa-quote-left"></i> Excellent service et produits de grande qualit√© ! <i class="fa-solid fa-quote-right"></i></p>
</section>

<section class="faq scroll-animate">
    <h2><i class="fa-solid fa-circle-question"></i> Questions fr√©quentes</h2>
    <div class="faq-item">
        <h3>Livrez-vous dans tout le pays ?</h3>
        <p>Oui, nous livrons dans toutes les r√©gions.</p>
    </div>
    <div class="faq-item">
        <h3>Vos produits sont-ils certifi√©s ?</h3>
        <p>Oui, tous nos produits r√©pondent aux normes de qualit√©.</p>
    </div>
    <div class="faq-item">
        <h3>Quels moyens de paiement acceptez-vous ?</h3>
        <p>Nous acceptons les paiements par üì± mobile money (Flooz et Mix Bay Yas) et virement bancaire.</p>
    </div>
</section>

<button id="scrollTopBtn"><i class="fa-solid fa-arrow-up"></i></button>

<button class="cart-button" id="cart-button">
    <i class="fa-solid fa-cart-shopping"></i> <span id="cart-count">0</span>
</button>

<div id="cart-modal" class="cart-modal">
    <div class="cart-modal-content">
        <span class="close-button">&times;</span>
        <h2>Votre Panier</h2>
        <ul id="cart-items"></ul>
        <div id="cart-modal-footer">
            <div id="cart-total"></div>
            <button id="checkout-button">Proc√©der √† l'achat</button>
        </div>
    </div>
</div>

<div id="cart-notification" class="cart-notification">
    <img id="notification-img" src="" alt="Produit ajout√©">
    <span id="notification-message" class="message"></span>
</div>

<footer>
    <p>&copy; 2025 MedShop | <a href="#">Mentions l√©gales</a> | <a href="#">Politique de confidentialit√©</a></p>
</footer>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // ‚ö†Ô∏è REMPLACEZ PAR VOS PROPRES CL√âS FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyD0b69uQMJzpJagMgKrBqif26kv3wtXZwc",
  authDomain: "medshop-d78e1.firebaseapp.com",
  projectId: "medshop-d78e1",
  storageBucket: "medshop-d78e1.firebasestorage.app",
  messagingSenderId: "972474612085",
  appId: "1:972474612085:web:c2314bdc99eb652084fb3c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allProducts = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    async function loadProducts() {
        try {
            const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
            const querySnapshot = await getDocs(q);
            
            allProducts = [];
            querySnapshot.forEach((doc) => {
                allProducts.push({ id: doc.id, ...doc.data() });
            });

            displayCategories();
            displayFeaturedProducts();
            
        } catch (error) {
            console.error("Erreur:", error);
            showErrorMessage();
        }
    }

    function displayCategories() {
        const categoryList = document.getElementById('categoryList');
        const categoryCounts = {};
        const categoryImages = {};
        
        allProducts.forEach(product => {
            if (!categoryCounts[product.category]) {
                categoryCounts[product.category] = 0;
                categoryImages[product.category] = product.imageUrl;
            }
            categoryCounts[product.category]++;
        });

        const categoryNames = {
            'savon': 'Savon',
            'poudre': 'Poudre m√©dicale',
            'pomade': 'Pomade',
            'autre': 'Autre'
        };

        if (Object.keys(categoryCounts).length === 0) {
            categoryList.innerHTML = '<p style="text-align: center; color: #666;">Aucune cat√©gorie disponible</p>';
            return;
        }

        categoryList.innerHTML = Object.entries(categoryCounts).map(([category, count]) => `
            <div class="category">
                <a href="articles.html?category=${category}">
                    <img src="${categoryImages[category]}" alt="${categoryNames[category] || category}"/>
                </a>
                <p>${categoryNames[category] || category}</p>
                <span style="font-size: 14px; color: #666; font-weight: 600;">
                    ${count} produit${count > 1 ? 's' : ''}
                </span>
            </div>
        `).join('');
    }

    function displayFeaturedProducts() {
        const featuredContainer = document.getElementById('featuredProducts');
        
        if (allProducts.length === 0) {
            featuredContainer.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">Aucun produit disponible</p>';
            return;
        }

        const featured = allProducts.slice(0, 6);
        
        featuredContainer.innerHTML = featured.map((product, index) => {
            const isNew = index < 3;
            const stockStatus = product.stock > 10 ? 'high' : product.stock > 0 ? 'low' : 'out';
            const stockText = product.stock > 10 ? `En stock (${product.stock})` : 
                            product.stock > 0 ? `Stock faible (${product.stock})` : 
                            'Rupture de stock';

            return `
                <div class="product" data-id="${product.id}" data-name="${product.name}" data-price="${product.price}">
                    ${isNew ? '<span class="new-badge">‚ú® NOUVEAU</span>' : ''}
                    <span class="category-badge badge-${product.category}">${product.category}</span>
                    <img src="${product.imageUrl}" alt="${product.name}"/>
                    
                    <span class="stock-indicator stock-${stockStatus}">
                        ${stockStatus === 'high' ? '‚úì' : stockStatus === 'low' ? '‚ö†' : '‚úó'} ${stockText}
                    </span>
                    
                    <p style="font-size: 20px; font-weight: bold; color: #007bff; margin: 10px 0;">
                        ${product.name}
                    </p>
                    <p style="font-size: 24px; font-weight: bold; color: #28a745; margin: 10px 0;">
                        ${product.price} FCFA
                    </p>
                    
                    <div class="quantity-selector">
                        <button class="decrement-btn" ${product.stock === 0 ? 'disabled' : ''}>-</button>
                        <span class="quantity-count">0</span>
                        <button class="increment-btn" ${product.stock === 0 ? 'disabled' : ''}>+</button>
                    </div>
                    
                    <button class="add-to-cart" disabled ${product.stock === 0 ? 'style="background: #ccc; cursor: not-allowed;"' : ''}>
                        <i class="fa-solid fa-cart-shopping"></i> 
                        ${product.stock === 0 ? 'Rupture de stock' : 'Ajouter au panier'}
                    </button>
                </div>
            `;
        }).join('');

        attachProductEvents();
    }

    function attachProductEvents() {
        document.querySelectorAll('.product').forEach(product => {
            const decrementBtn = product.querySelector('.decrement-btn');
            const incrementBtn = product.querySelector('.increment-btn');
            const quantitySpan = product.querySelector('.quantity-count');
            const addToCartBtn = product.querySelector('.add-to-cart');
            
            const productData = allProducts.find(p => p.id === product.dataset.id);
            const maxStock = productData ? productData.stock : 0;

            incrementBtn.addEventListener('click', () => {
                let quantity = parseInt(quantitySpan.textContent);
                if (quantity < maxStock) {
                    quantity++;
                    quantitySpan.textContent = quantity;
                    addToCartBtn.disabled = false;
                }
            });

            decrementBtn.addEventListener('click', () => {
                let quantity = parseInt(quantitySpan.textContent);
                if (quantity > 0) {
                    quantity--;
                    quantitySpan.textContent = quantity;
                }
                if (quantity === 0) {
                    addToCartBtn.disabled = true;
                }
            });

            addToCartBtn.addEventListener('click', () => {
                const quantity = parseInt(quantitySpan.textContent);
                if (quantity > 0 && maxStock > 0) {
                    const existingItem = cart.find(item => item.id === product.dataset.id);
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({
                            id: product.dataset.id,
                            name: product.dataset.name,
                            price: parseFloat(product.dataset.price),
                            img: product.querySelector('img').src,
                            quantity: quantity
                        });
                    }

                    updateCartDisplay();
                    showNotification({ 
                        name: product.dataset.name, 
                        img: product.querySelector('img').src 
                    });

                    quantitySpan.textContent = "0";
                    addToCartBtn.disabled = true;
                }
            });
        });
    }

    function showErrorMessage() {
        document.getElementById('categoryList').innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <i class="fa-solid fa-exclamation-triangle" style="font-size: 48px; color: #ef4444;"></i>
                <p style="color: #ef4444; font-weight: 600;">Erreur de chargement</p>
                <p style="color: #666;">V√©rifiez votre configuration Firebase</p>
            </div>
        `;
        document.getElementById('featuredProducts').innerHTML = document.getElementById('categoryList').innerHTML;
    }

    function updateCartDisplay() {
        const cartCountSpan = document.getElementById('cart-count');
        const cartItemsList = document.getElementById('cart-items');
        const cartTotalDiv = document.getElementById('cart-total');

        let totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        let total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        cartCountSpan.textContent = totalItems;

        if (cartItemsList) {
            cartItemsList.innerHTML = cart.map((item, index) => `
                <li class="cart-item">
                    <img src="${item.img}" alt="${item.name}" class="cart-item-img">
                    <div class="cart-item-details">
                        <h4>${item.name}</h4>
                        <p>${item.price} FCFA</p>
                        <div class="cart-item-quantity">Quantit√© : ${item.quantity}</div>
                    </div>
                    <button class="remove-item" data-index="${index}">&times;</button>
                </li>
            `).join('');

            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    cart.splice(index, 1);
                    updateCartDisplay();
                });
            });
        }

        if (cartTotalDiv) cartTotalDiv.textContent = `Total : ${total} FCFA`;
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function showNotification(item) {
        const notification = document.getElementById('cart-notification');
        const notificationImg = document.getElementById('notification-img');
        const notificationMessage = document.getElementById('notification-message');
        
        notificationImg.src = item.img;
        notificationMessage.textContent = `${item.name} a √©t√© ajout√© au panier !`;
        notification.classList.add('visible');
        
        setTimeout(() => {
            notification.classList.remove('visible');
        }, 3000);
    }

    const cartButton = document.getElementById('cart-button');
    const cartModal = document.getElementById('cart-modal');
    const closeButton = document.querySelector('.close-button');
    const checkoutButton = document.getElementById('checkout-button');

    if (cartButton) {
        cartButton.addEventListener('click', () => {
            updateCartDisplay();
            cartModal.style.display = 'block';
        });
    }

    if (closeButton) {
        closeButton.addEventListener('click', () => {
            cartModal.style.display = 'none';
        });
    }

    if (checkoutButton) {
        checkoutButton.addEventListener('click', () => {
            if (cart.length === 0) {
                alert("Votre panier est vide.");
                return;
            }

            const whatsappNumber = "22870445866";
            let orderMessage = "Salut ! üëã J'aimerais passer la commande suivante :\n\n";
            let total = 0;

            cart.forEach(item => {
                orderMessage += `üõí ${item.name} x${item.quantity} - ${item.price * item.quantity} FCFA\n`;
                total += item.price * item.quantity;
            });

            orderMessage += `\nüí∞ Total : ${total} FCFA\n\nMerci de me donner les d√©tails de la livraison et du paiement ! üôè`;

            const encodedMessage = encodeURIComponent(orderMessage);
            window.location.href = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
        });
    }

    loadProducts();
    updateCartDisplay();
</script>

<script src="script.js"></script>
</body>
</html>